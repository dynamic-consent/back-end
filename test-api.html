<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터베이스 입력 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #555;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>데이터베이스 입력 테스트</h1>
        <p><strong>서버 주소:</strong> http://172.19.26.41:8080</p>
    </div>

    <div class="container">
        <h2>인증 설정</h2>
        <div class="form-group">
            <label for="authToken">인증 토큰:</label>
            <input type="text" id="authToken" placeholder="Bearer 토큰을 입력하세요">
        </div>
        <button onclick="setAuthToken()">토큰 설정</button>
    </div>

    <div class="container">
        <h2>사용자 관련 API</h2>
        <button onclick="getUserProfile()">사용자 프로필 조회</button>
        <button onclick="updateUserProfile()">사용자 프로필 수정</button>
        <div id="userResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>조직 관련 API</h2>
        <div class="form-group">
            <label for="orgCategory">조직 카테고리:</label>
            <select id="orgCategory">
                <option value="">전체</option>
                <option value="FINANCE">금융</option>
                <option value="HEALTHCARE">의료</option>
                <option value="INSURANCE">보험</option>
                <option value="GOVERNMENT">정부</option>
            </select>
        </div>
        <button onclick="getOrganizations()">조직 목록 조회</button>
        <div id="orgResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>동의서 관련 API</h2>
        <div class="form-group">
            <label for="consentStatus">동의서 상태:</label>
            <select id="consentStatus">
                <option value="">전체</option>
                <option value="ACTIVE">활성</option>
                <option value="REVOKED">철회</option>
            </select>
        </div>
        <button onclick="getConsents()">동의서 목록 조회</button>
        <button onclick="getConsentEvents()">동의서 이벤트 조회</button>
        <div id="consentResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>동의서 생성</h2>
        <div class="form-group">
            <label for="newOrgId">조직 ID:</label>
            <input type="text" id="newOrgId" placeholder="BANK001">
        </div>
        <div class="form-group">
            <label for="newTitle">제목:</label>
            <input type="text" id="newTitle" placeholder="동의서 제목">
        </div>
        <div class="form-group">
            <label for="newDescription">설명:</label>
            <textarea id="newDescription" rows="3" placeholder="동의서 설명"></textarea>
        </div>
        <button onclick="createConsent()">동의서 생성</button>
        <div id="createResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>동의서 수정/철회</h2>
        <div class="form-group">
            <label for="consentId">동의서 ID:</label>
            <input type="number" id="consentId" placeholder="1">
        </div>
        <button onclick="updateConsent()">동의서 수정</button>
        <button onclick="revokeConsent()">동의서 철회</button>
        <div id="updateResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://172.19.26.41:8080/api/v1';
        let authToken = '';

        function setAuthToken() {
            authToken = document.getElementById('authToken').value;
            showResult('userResult', '토큰이 설정되었습니다.', 'success');
        }

        function getHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            };
        }

        function showResult(elementId, data, type = '') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
        }

        async function getUserProfile() {
            try {
                const response = await fetch(`${API_BASE_URL}/me`, {
                    method: 'GET',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResult('userResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('userResult', `오류: ${error.message}`, 'error');
            }
        }

        async function updateUserProfile() {
            const updateData = {
                displayName: '홍길동',
                email: 'hong@example.com',
                phoneNumber: '010-1234-5678'
            };

            try {
                const response = await fetch(`${API_BASE_URL}/me`, {
                    method: 'PATCH',
                    headers: getHeaders(),
                    body: JSON.stringify(updateData)
                });
                const data = await response.json();
                showResult('userResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('userResult', `오류: ${error.message}`, 'error');
            }
        }

        async function getOrganizations() {
            const category = document.getElementById('orgCategory').value;
            const url = category ? `${API_BASE_URL}/orgs?category=${category}&page=0&size=10` : `${API_BASE_URL}/orgs?page=0&size=10`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResult('orgResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('orgResult', `오류: ${error.message}`, 'error');
            }
        }

        async function getConsents() {
            const status = document.getElementById('consentStatus').value;
            const url = status ? `${API_BASE_URL}/consents?status=${status}&page=0&size=20` : `${API_BASE_URL}/consents?page=0&size=20`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResult('consentResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('consentResult', `오류: ${error.message}`, 'error');
            }
        }

        async function getConsentEvents() {
            try {
                const response = await fetch(`${API_BASE_URL}/consents/events?from=2024-01-01T00:00:00Z&to=2024-12-31T23:59:59Z&page=0&size=20`, {
                    method: 'GET',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResult('consentResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('consentResult', `오류: ${error.message}`, 'error');
            }
        }

        async function createConsent() {
            const orgId = document.getElementById('newOrgId').value;
            const title = document.getElementById('newTitle').value;
            const description = document.getElementById('newDescription').value;

            if (!orgId || !title) {
                showResult('createResult', '조직 ID와 제목은 필수입니다.', 'error');
                return;
            }

            const consentData = { orgId, title, description };

            try {
                const response = await fetch(`${API_BASE_URL}/consents`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(consentData)
                });
                const data = await response.json();
                showResult('createResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('createResult', `오류: ${error.message}`, 'error');
            }
        }

        async function updateConsent() {
            const consentId = document.getElementById('consentId').value;
            if (!consentId) {
                showResult('updateResult', '동의서 ID를 입력하세요.', 'error');
                return;
            }

            const updateData = {
                scopes: ['PERSONAL_INFO', 'FINANCIAL_INFO', 'CONTACT_INFO'],
                validUntil: '2025-12-31T23:59:59Z',
                purpose: '신용카드 발급 및 관리'
            };

            try {
                const response = await fetch(`${API_BASE_URL}/consents/${consentId}`, {
                    method: 'PATCH',
                    headers: getHeaders(),
                    body: JSON.stringify(updateData)
                });
                const data = await response.json();
                showResult('updateResult', data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('updateResult', `오류: ${error.message}`, 'error');
            }
        }

        async function revokeConsent() {
            const consentId = document.getElementById('consentId').value;
            if (!consentId) {
                showResult('updateResult', '동의서 ID를 입력하세요.', 'error');
                return;
            }

            const revokeData = { reason: '서비스 이용 중단' };

            try {
                const response = await fetch(`${API_BASE_URL}/consents/${consentId}:revoke`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(revokeData)
                });
                const message = response.ok ? '동의서 철회 완료' : `오류: ${response.status}`;
                showResult('updateResult', message, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('updateResult', `오류: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>


